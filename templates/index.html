{{define "title"}}Index{{end}}
{{define "body-content"}}

<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js" integrity="sha256-t9UJPrESBeG2ojKTIcFLPGF7nHi2vEc7f5A2KpH/UBU="
        crossorigin="anonymous"></script>

<script>
    Chart.defaults.global.elements.rectangle.backgroundColor = 'rgba(76,82,112)'
    //Chart.defaults.global.elements.rectangle.borderColor = 'rgba(188,236,224)'

    function buildBarChart(canvasId, x, y, xLabel, yLabel, title){
        const ctx = document.getElementById(canvasId).getContext("2d")
        const myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: x,
                datasets: [{
                    data: y,
                    barThickness:"4"
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: yLabel
                        },
                        ticks: {
                            beginAtZero: true
                        }
                    }],
                    xAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: xLabel
                        },
                    }]
                },
                responsive: true,
                legend: {
                    display: false
                },
                title: {
                    display: true,
                    text: title
                }
            }
        });
    }

    function parseJSONResponse(response){
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    }

    document.addEventListener("DOMContentLoaded", (event) => {
        fetch(new Request("/stats/playlists-length-distribution"))
            .then(parseJSONResponse)
            .then((distribution) => {
                const canvasId = "playlists-length-distribution-canvas"
                const x = distribution.map((x) => x["PlaylistLength"])
                const y = distribution.map((x) => x["NumPlaylists"])
                buildBarChart(canvasId, x,y, "length(seconds)", "#playlists", "Playlists Length Distribution")
            })

        fetch(new Request("/stats/num-playlists-per-user-distribution"))
            .then(parseJSONResponse)
            .then((distribution) => {
                const canvasId = "num-playlists-per-user-distribution-canvas"
                const x = distribution.map((x) => x["NumberOfPlaylists"])
                const y = distribution.map((x) => x["NumberOfUsers"])
                buildBarChart(canvasId, x,y, "#playlists", "#users", "Playlists Per User Distribution")
            })

        fetch(new Request("/stats/num-tracks-per-playlists-distribution"))
            .then(parseJSONResponse)
            .then((distribution) => {
                const canvasId = "num-tracks-per-playlists-distribution-canvas"
                const x = distribution.map((x) => x["NumberOfTracks"])
                const y = distribution.map((x) => x["NumberOfPlaylists"])
                buildBarChart(canvasId, x,y, "#tracks", "#playlists", "Tracks Per Playlist Distribution")
            })

        let nplaylists = document.getElementById("num-playlists")
        let nusers  = document.getElementById("num-users")
        nplaylists.textContent = parseInt(nplaylists.textContent).toLocaleString() + " playlists"
        nusers.textContent = parseInt(nusers.textContent).toLocaleString() + " users"

    })
</script>

<div class="container-md" style="max-width: 100%">
    <div class="row">
        <div class="col-md-6" style="padding-left: 5%; padding-top: 5%">
            <h2 id="num-users">{{.NumUsers}} users</h2>
            <h2 id="num-playlists">{{.NumPlaylists}} playlists</h2>
            <hr>
            <h3> {{.AvgPlaylistsPerUser}} average playlist per user </h3>
            <h3> {{.AvgTracksPerPlaylist}} average tracks per playlist</h3>
            <h3> {{.AvgPlaylistLength}} average playlist length</h3>
        </div>
        <div class="col-md-6">
            <canvas id="playlists-length-distribution-canvas"></canvas>
        </div>
        <div class="col-md-6">
            <canvas id="num-playlists-per-user-distribution-canvas"></canvas>
        </div>
        <div class="col-md-6">
            <canvas id="num-tracks-per-playlists-distribution-canvas"></canvas>
        </div>
    </div>
</div>

{{end}}